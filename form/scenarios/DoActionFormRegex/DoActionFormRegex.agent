<Agent xmlns:Agent="http://schemas.microsoft.com/ConversationalAgent/1.0">
  <AgentDefinition lang="en-us">

    <Task name="task1" doAction="Form" thenAction="">
      <RegexRecognizer pattern="Order s" />
      <FormRef name="SandwichOrder" refTo="SandwichOrder" />
    </Task>

    <Form name="SandwichOrder">

        <!-- Fields -->

        <Field entity="breadType" displayName="type of bread" required="true" preserveInGlobal="true"></Field>
        <Field entity="proteinOption" displayName="protein" required="true"></Field>
        <Field entity="sandwichSize" displayName="size" required="true"></Field>
        <Field entity="mustard" displayName="mustard"></Field>
        <Field entity="sandwichToppings" displayName="toppings" acceptsMultipleValues="true"></Field>

        <!-- Prompts -->

        <PromptForInput when="breadType">
            <Feedback>[TodayWeOfferTheseBreads]. Please choose a bread type.</Feedback>
        </PromptForInput>

        <PromptForInput when="proteinOption">
            <Feedback>Please choose a protein option.</Feedback>
        </PromptForInput>

        <PromptForInput when="sandwichSize">
            <Feedback>Please choose a size.</Feedback>
        </PromptForInput>

        <PromptForInput when="builtin.allRequiredFilled">
            <Feedback>Here's what I have: [builtin.filledFields]. Do you want to order this?</Feedback>
        </PromptForInput>

        <!-- Actions -->

        <FormAction type="AddOrUpdate">
            <RegexRecognizer pattern="Order s" />
        </FormAction>
        
        <FormAction type="Confirm">
            <CodeRecognizer onRun="builtin.confirm" />
            <Feedback>OK</Feedback>
        </FormAction>
        
        <FormAction type="Cancel">
            <CodeRecognizer onRun="builtin.cancel"></CodeRecognizer>
            <Feedback>Order canceled - come back soon!</Feedback>
        </FormAction>

        <FormAction type="Help">
            <CodeRecognizer onRun="builtin.help"></CodeRecognizer>
            <Feedback>So far you have: [builtin.filledFields]. The following missing are required [builtin.requiredFieldsMissing] and the following are further options: [builtin.optionalFieldsMissing].</Feedback>
        </FormAction>

    </Form>

    <!-- Templates -->

    <SimpleResponseTemplate name="TodayWeOfferTheseBreads">
      <Feedback>Today we offer [BreadTypes]</Feedback>
    </SimpleResponseTemplate>

    <SimpleResponseTemplate name="BreadTypes">
      <Feedback>white-bread, wheat-bread or sourdough-bread</Feedback>
    </SimpleResponseTemplate>

  </AgentDefinition>
</Agent>
