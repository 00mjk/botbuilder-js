steps:
  - task: DownloadPipelineArtifact@2
    inputs:
      artifact: ReactApp
      path: $(ReactProjectDir)
  
  - task: DownloadPipelineArtifact@2
    inputs:
      artifact: DirectLineJsTgz
      path: $(RootReactPiecesDir)

  - powershell: |
      Set-Location -Path "$(ReactProjectDir)"
      
      New-Item -Path . -Name ".npmrc" -ItemType "file" -Value "registry=https://botbuilder.myget.org/F/botbuilder-v4-js-daily/npm/"
    displayName: 'Create .npmrc for MyGet feed - https://botbuilder.myget.org/gallery/botbuilder-v4-js-daily'

  - powershell: npm install $(RootReactPiecesDir)/botframework-directlinejs.tgz
    displayName: npm install botframework-directlinejs.tgz
    workingDirectory: $(ReactProjectDir)
  
  - task: Cache@2
    displayName: Cache npm
    inputs:
      key: 'cache-bfwc-dotenv-consecutive-in-same-job | npm | "$(Agent.OS)" |  $(ReactProjectDir)/package-lock.json'
      path: $(ReactProjectDir)/node_modules
      cacheHitVar: 'WcCacheRestored'
  
  - powershell: npm install botframework-webchat@4.9.2
    displayName: 'npm install botframework-webchat'
    workingDirectory: $(ReactProjectDir)
    condition: ne(variables.WcCacheRestored, 'true')

  - powershell: npm install dotenv
    displayName: 'npm install dotenv'
    workingDirectory: $(ReactProjectDir)
    condition: ne(variables.WcCacheRestored, 'true')
